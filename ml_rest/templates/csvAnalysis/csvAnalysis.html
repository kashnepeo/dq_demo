<!DOCTYPE html>
<html lang="ko">
	<head>
		<meta charset="utf-8">
		<!--<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">-->
		<title> TA </title>
		<meta name="description" content="">
		<meta name="author" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<!-- Basic Styles -->
		<link rel="stylesheet" type="text/css" media="screen" href="{{ url_for('static', filename = 'bootstrap/css/bootstrap.min.css') }}">
		<!-- SmartAdmin Styles : Caution! DO NOT change the order -->
        <link rel="stylesheet" type="text/css" media="screen" href="{{ url_for('static', filename = 'smartadmin/css/smartadmin-production-plugins.min.css') }}">
        <link rel="stylesheet" type="text/css" media="screen" href="{{ url_for('static', filename = 'smartadmin/css/smartadmin-production.min.css') }}">
        <link rel="stylesheet" type="text/css" media="screen" href="{{ url_for('static', filename = 'smartadmin/css/smartadmin-skins.min.css') }}">
        <link rel="stylesheet" type="text/css" media="screen" href="{{ url_for('static', filename = 'smartadmin/css/smartadmin-rtl.min.css') }}"> <!-- SmartAdmin RTL Support  -->
        <link rel="stylesheet" type="text/css" media="screen" href="{{ url_for('static', filename = 'smartadmin/css/demo.min.css') }}">
        <link rel="stylesheet" type="text/css" media="screen" href="{{ url_for('static', filename = 'toast/chart/css/tui-chart.min.css') }}"> <!-- Toast-ui Chart v3.7.0 -->
        <link rel="stylesheet" type="text/css" media="screen" href="{{ url_for('static', filename = 'common/css/common.css') }}">
		<!-- Favicon -->
        <link rel="shortcut icon" type="image/x-icon" href="{{ url_for('static', filename = 'image/favicon.ico') }}">
        <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename = 'image/favicon.ico') }}">
        <link rel="stylesheet" type="text/css" media="screen" href="{{ url_for('static', filename = 'common/font/font-awesome.min.css') }}"> <!-- Default Font -->
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename = 'common/font/font.css') }}"> <!-- Default Font -->
        <!-- grid Style -->
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename = 'grid/css/smoothness/jquery-ui-1.8.16.custom.css') }}">
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename = 'grid/slick.grid.css') }}">
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename = 'grid/plugins/slick.headerbuttons.css') }}">
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename = 'grid/controls/slick.columnpicker.css') }}">
        <style>
            .cancelEvent{
                cursor:default;
            }
        </style>
	</head>
	<body class="">
		<header id="header">
			<div id="logo-group">
				<span id="logo">TA 분석 모델링</span>
			</div>
			<div class="pull-right">
				<div id="hide-menu" class="btn-header pull-right">
					<span> <a href="javascript:void(0);" data-action="toggleMenu" title="Collapse Menu"><i class="fa fa-reorder"></i></a> </span>
				</div>
				<form action="#" class="header-search pull-right">
					<input id="search-fld"  type="text" name="param" placeholder="Find reports and more" data-autocomplete='[
					"test1",
					"test2",
					"test3",
					]'>
					<button type="submit">
						<i class="fa fa-search"></i>
					</button>
				</form>
				<div id="fullscreen" class="btn-header transparent pull-right">
					<span> <a href="javascript:void(0);" data-action="launchFullscreen" title="Full Screen"><i class="fa fa-arrows-alt"></i></a> </span>
				</div>
			</div>
		</header>
		<aside id="left-panel">
			<div class="login-info">
				<div class="file-upload">
                    <div>
                        <span style="color: #fff;">CSV 업로드</span>
                        <button class="btn btn-sm btn-primary" style="border-radius:12px;" id="dialog_link" class="btn btn-info">파일 선택</button>
                    </div>
				<div>
			</div>
{#			<nav>#}
{#				<ul>#}
{#					<li class="active open">#}
{#						<a href="#"><i class="fa fa-lg fa-fw fa-cube txt-color-blue"></i> <span class="menu-item-parent">분석 모델 선택</span></a>#}
{#						<ul style="display: block;">#}
{#							<li class="active">#}
{#								<a href="#" title=""><span class="menu-item-parent">신규 고객 모델링</span></a>#}
{#							</li>#}
{#							<li>#}
{#								<a href="#" title=""><span class="menu-item-parent">이탈 고객 모델링</span></a>#}
{#							</li>#}
{#							<li class="">#}
{#								<a href="#" title=""><span class="menu-item-parent">VOC 분석 모델링</span></a>#}
{#							</li>#}
{#							<li class="">#}
{#								<a href="#" title=""><span class="menu-item-parent">고객 반응 분석 모델링</span></a>#}
{#							</li>#}
{#						</ul>#}
{#					</li>#}
{#				</ul>#}
{#			</nav>#}
		</aside>
		<div id="main" role="main">
            <div id="dialog_simple" title="Dialog Simple Title">
                <div class="widget-body">
                    <div id="bootstrap-wizard-1" class="col-sm-12">
                        <div class="form-bootstrapWizard">
                            <ul class="bootstrapWizard form-wizard">
                                <li class="active" data-target="#step1">
                                    <a href="#tab1" data-toggle="tab" aria-expanded="true" class="cancelEvent"> <span class="step">1</span> <span class="title">CSV Upload</span> </a>
                                </li>
                                <li data-target="#step2" class="">
                                    <a href="#tab2" data-toggle="tab" aria-expanded="false" class="cancelEvent"> <span class="step">2</span> <span class="title">신규 모델 생성</span> </a>
                                </li>
                                <li data-target="#step3" class="">
                                    <a href="#tab3" data-toggle="tab" aria-expanded="false" class="cancelEvent"> <span class="step">3</span> <span class="title">CSV 설정</span> </a>
                                </li>
                                <li data-target="#step4" class="">
                                    <a href="#tab4" data-toggle="tab" aria-expanded="false" class="cancelEvent"> <span class="step">4</span> <span class="title">설정 완료</span> </a>
                                </li>
                            </ul>
                            <div class="clearfix"></div>
                        </div>
                        <div class="tab-content">
                            <div id="loading_oh" style="position: absolute;margin: 10% 20% 0% 40%;z-index:1;">
                                <table width="auto" height="auto" align="center" cellpadding="0" cellspacing="0">
                                    <tr>
                                        <td align="center"><img src="{{ url_for('static', filename = 'image/loading.gif') }}" border="0"><br><b><font color="black">잠시만 기다려 주세요</font></b></td>
                                    </tr>
                                </table>
                            </div>
                            <div class="tab-pane active" id="tab1">
                                <br>
                                <h3><strong>Step 1 </strong> - CSV File Upload</h3>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <!-- start -->
                                            <form id="order-form" class="smart-form" enctype="multipart/form-data" method="POST">
                                                <div class="input input-file">
                                                    <span class="button">
                                                    <input id="file2" type="file" name="file2" onchange="this.parentNode.nextSibling.value = this.value">Browse</span><input type="text" placeholder="Include some files" readonly="">
                                                </div>
                                            </form>
                                            <!--end-->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="tab2">
                                <br>
                                <h3><strong>Step 2</strong> - 신규 모델 생성</h3>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <form id="contact-form" method="post" class="smart-form" novalidate="novalidate">
                                                <label class="label">모델명</label>
                                                <label class="input">
                                                    <i class="icon-append fa fa-tag"></i>
                                                    <input type="text" name="subject" id="subject">
                                                </label>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="smart-form">
                                            <section>
                                                <label class="label">모델 유형</label>
                                                <div class="inline-group">
                                                    <label class="radio">
                                                        <input type="radio" name="model-category" checked="checked">
                                                        <i></i>분류</label>
                                                    <label class="radio">
                                                        <input type="radio" name="model-category">
                                                        <i></i>회귀</label>
                                                </div>
                                            </section>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="tab3">
                                <br>
                                <h3><strong>Step 3</strong> - CSV 설정</h3>
                                 <div class="row">
                                    <div class="col-sm-12">
                                        <div class="smart-form">
                                            <section>
                                                <label class="label"><strong>모델 저장</strong></label>
                                                <div class="inline-group">
                                                    <label class="radio">
                                                        <input type="radio" name="model-save" checked="checked">
                                                        <i></i>가망 고객 분석</label>
                                                    <label class="radio">
                                                        <input type="radio" name="model-save">
                                                        <i></i>고객 반응 분석</label>
                                                    <label class="radio">
                                                        <input type="radio" name="model-save">
                                                        <i></i>이탈 고객 분석</label>
                                                    <label class="radio">
                                                        <input type="radio" name="model-save">
                                                        <i></i>민원 고객 분석</label>
                                                </div>
                                            </section>
                                        </div>
                                    </div>
                                </div>
                                 <div class="row">
                                    <div class="col-sm-12">
                                        <div class="smart-form">
                                            <section>
                                                <label class="label"><strong>학습 컬럼 선택</strong></label>
                                                <div class="inline-group" id="learningArea">

                                                </div>
                                            </section>
                                        </div>
                                    </div>
                                </div>
                                 <div class="row">
                                    <div class="col-sm-12">
                                        <div class="smart-form">
                                            <section>
                                                <label class="label"><strong>예측 컬럼 선택</strong></label>
                                                <div class="inline-group" id="predictionArea">
                                                </div>
                                            </section>
                                        </div>
                                    </div>
                                </div>
{#                                <div class="row">#}
{#                                    <div class="col-sm-12">#}
{#                                        <div class="smart-form">#}
{#                                            <div id="csvGrid" style="width:auto;height:200px;"></div>#}
{#                                        </div>#}
{#                                    </div>#}
{#                                </div>#}
                            </div>
                            <div class="tab-pane" id="tab4">
                                <br>
                                <h3><strong>Step 4</strong> - 설정 완료</h3>
                                <br>
                                <h1 class="text-center text-success"><strong><i class="fa fa-check fa-lg"></i> Complete</strong></h1>
                                <h4 class="text-center">Click next to finish</h4>
                                <br>
                                <br>
                            </div>
                            <div class="form-actions" style="margin-bottom:0px;">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <ul class="pager wizard no-margin no-steps-container">
                                            <li class="next">
                                                <a href="javascript:void(0);" class="btn btn-default txt-color-darken"> Next </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
			<div id="ribbon">
				<span class="ribbon-button-alignment">
					<span id="refresh" class="btn btn-ribbon" data-action="resetWidgets" data-title="refresh"  rel="tooltip" data-placement="bottom" data-original-title="<i class='text-warning fa fa-warning'></i> Warning! This will reset all your widget settings." data-html="true">
						<i class="fa fa-refresh"></i>
					</span>
				</span>

				<ol class="breadcrumb">
					<li>Home</li>
					<li>TA 분석 모델링</li>
				</ol>
			</div>
			<div id="ribbon" class="filter">
				<div class="smart-form">
					<div class="inline-group">
						<label class="date-label-left" style="padding-top: 10px !important;">Layout</label>
						<label><a href="#"><i class="fa fa-stop filter-layout"></i></a></label>
						<label><a href="#"><i class="fa fa-pause filter-layout"></i></a></label>
						<label><a href="#"><i class="fa fa-th-large filter-layout"></i></a></label>
					</div>
				</div>
			</div>
		</div>
		<div class="page-footer">
			<div class="row">
				<div class="col-xs-12 col-sm-6">
					<span class="txt-color-white">Diquest<span class="hidden-xs"> - TA 1.0</span> © 2019</span>
				</div>
			</div>
		</div>
        <script src="{{ url_for('static', filename = 'jquery/js/jquery.min.js') }}"></script> <!-- jquery v2.2.4 -->
        <script src="{{ url_for('static', filename = 'jquery/js/jquery.mb.browser.min.js') }}"></script> <!-- browser msie issue fix -->
        <script src="{{ url_for('static', filename = 'jquery/js/jquery.validate.min.js') }}"></script>
        <script src="{{ url_for('static', filename = 'smartadmin/js/pace.min.js') }}" data-pace-options='{"restartOnRequestAfter": true }'></script> <!-- PACE LOADER -->
        <script src="{{ url_for('static', filename = 'smartadmin/js/jquery-ui.min.js') }}"></script> <!-- jquery-ui v1.12.1 -->
        <script src="{{ url_for('static', filename = 'smartadmin/js/app.config.js') }}"></script> <!-- IMPORTANT: APP CONFIG -->
        <script src="{{ url_for('static', filename = 'bootstrap/js/bootstrap.min.js') }}"></script> <!-- Bootstrap v3.3.7 -->
        <script src="{{ url_for('static', filename = 'smartadmin/js/SmartNotification.min.js') }}"></script> <!-- CUSTOM NOTIFICATION -->
        <script src="{{ url_for('static', filename = 'smartadmin/js/jarvis.widget.min.js') }}"></script> <!-- JARVIS WIDGETS -->
        <script src="{{ url_for('static', filename = 'smartadmin/js/select2.min.js') }}"></script> <!-- JQUERY SELECT2 INPUT -->
        <script src="{{ url_for('static', filename = 'smartadmin/js/fastclick.min.js') }}"></script> <!-- FastClick: For mobile devices -->
        <script src="{{ url_for('static', filename = 'smartadmin/js/demo.min.js') }}"></script> <!-- Demo purpose only -->
        <script src="{{ url_for('static', filename = 'smartadmin/js/app.min.js') }}"></script> <!-- MAIN APP JS FILE -->
        <script src="{{ url_for('static', filename = 'smartadmin/js/jquery.bootstrap.wizard.min.js') }}"></script> <!-- wizard JS FILE -->
        <script src="{{ url_for('static', filename = 'smartadmin/js/wizard.min.js') }}"></script> <!-- wizard JS FILE -->
        <script src="{{ url_for('static', filename = 'toast/chart/js/tui-chart-all.js') }}"></script> <!-- Toast-ui chart v3.7.0 -->


        <script src='{{ url_for('static', filename = 'grid/lib/firebugx.js') }}' type='text/javascript'></script>
        <script src='{{ url_for('static', filename = 'grid/lib/jquery.event.drag-2.2.js') }}' type='text/javascript'></script>
        <script src='{{ url_for('static', filename = 'grid/slick.core.js') }}' type='text/javascript'></script>
        <script src='{{ url_for('static', filename = 'grid/slick.grid.js') }}' type='text/javascript'></script>
        <script src='{{ url_for('static', filename = 'grid/plugins/slick.headerbuttons.js') }}' type='text/javascript'></script>
        <script src='{{ url_for('static', filename = 'grid/plugins/slick.checkboxselectcolumn.js') }}' type='text/javascript'></script>
        <script src='{{ url_for('static', filename = 'grid/plugins/slick.autotooltips.js') }}' type='text/javascript'></script>
        <script src='{{ url_for('static', filename = 'grid/plugins/slick.cellrangedecorator.js') }}' type='text/javascript'></script>
        <script src='{{ url_for('static', filename = 'grid/plugins/slick.cellrangeselector.js') }}' type='text/javascript'></script>
        <script src='{{ url_for('static', filename = 'grid/plugins/slick.cellcopymanager.js') }}' type='text/javascript'></script>
        <script src='{{ url_for('static', filename = 'grid/plugins/slick.cellselectionmodel.js') }}' type='text/javascript'></script>
        <script src='{{ url_for('static', filename = 'grid/plugins/slick.rowselectionmodel.js') }}' type='text/javascript'></script>
        <script src='{{ url_for('static', filename = 'grid/controls/slick.columnpicker.js') }}' type='text/javascript'></script>
        <script src='{{ url_for('static', filename = 'grid/slick.formatters.js') }}' type='text/javascript'></script>
        <script src='{{ url_for('static', filename = 'grid/slick.editors.js') }}' type='text/javascript'></script>

		<!--[if IE 8]>
		<h1>해당 Browser에서 지원하지 않습니다. Browser를 최신버전으로 업데이트 하세요.</h1>
		<![endif]-->
		<script>
			$(document).ready(function() {
			    $(".cancelEvent").click(function(){
			        return false;
                })

			    $("#loading_oh").hide();

                $('#dialog_link').click(function() {
                    $('#dialog_simple').dialog('open');
                    return false;

                });

                $('#dialog_simple').dialog({
                    autoOpen : false,
				    modal : true,
                    width : "40%",
                    height : "auto",
                    resizable : false,
                    title : "CSV 업로드",
                    close: function( event, ui ) {
                        $('#bootstrap-wizard-1').bootstrapWizard('first');
                        formReset();
                    }
                });

                $('#bootstrap-wizard-1').bootstrapWizard({
                    'tabClass': 'form-wizard',
                    'onNext': function (tab, navigation, index) {
                        if(index === 1) {
                            if($("#file2")[0].files.length > 0){
                                var ext = $("#file2")[0].files[0]['name'].split('.')[1];
                                if (ext !== 'csv') {
                                    alert("확장자 csv 파일 업로드해주세요.");
                                    return false;
                                } else {
                                    $("#loading_oh").show();
                                    var formData = new FormData($('#order-form')[0]);
                                    formData.append("fileObj", $("#file2")[0].files[0]);
                                        setTimeout(function() {
                                            $.ajax({
                                                url: '/fileUpload',
                                                processData: false,
                                                contentType: false,
                                                data: formData,
                                                type: 'POST',
                                                async: false,
                                                success: function (result) {
                                                    // 업로드 CSV 전송
                                                    fnGrid(result);
                                                    stepCheck(index);
                                                }
                                        });
                                    }, 100); //1000 = 1초

                                }
                            }else{
                                alert("파일을 선택 해주세요.");
                                return false;
                            }
                        }else if(index === 2){
                            stepCheck(index);
                        }else if(index === 3){
                            stepCheck(index);
                        }else if(index === 4){
                            stepCheck(index);
                        }
                    }
                });
			});


			var grid;
            var options = {
                enableCellNavigation: true,
                editable: true,
                asyncEditorLoading: false,
                autoEdit: false ,
                forceFitColumns: true ,
                enableColumnReorder: false,
                multiColumnSort: true
            };

            var fnGrid = function(resultList){
                var columns = [];
                var data = resultList;
                // 배열 0번째는 columns 명으로 제외
                var columnsName = data[0];

                var learningAppenHtml = "";
                $.each(columnsName, function(index, item){
                    learningAppenHtml += "<label class='radio'>" +
                    "<input type='radio' name='learning-column'>" +
                    "<i></i>"+item+"</label>";
                });

                var predictionAppenHtml = "";
                $.each(columnsName, function(index, item){
                    predictionAppenHtml += "<label class='radio'>" +
                    "<input type='radio' name='prediction-column'>" +
                    "<i></i>"+item+"</label>";
                });

                $("#learningArea").append(learningAppenHtml);
                $("#predictionArea").append(predictionAppenHtml);

                data.splice(0, 1);
                $("#loading_oh").hide();
                /*
                for (var i = 0; i < data[0].length; i++) {
                    columns.push({
                        id: i,
                        name: columnsName[i],
                        field: i,
                        sortable: true,
                        header: {
                            buttons: [
                                {
                                    cssClass: "icon-filter-highlight-off",
                                    command: "toggle-filter-highlight",
                                    tooltip: "Highlight negative numbers."
                                },
                                {
                                    cssClass: "icon-value-highlight-off",
                                    command: "toggle-value-highlight",
                                    tooltip: "Highlight negative numbers."
                                }
                            ]
                        }
                    });
                }

                grid = new Slick.Grid("#csvGrid", data, columns, options);
                grid.setSelectionModel(new Slick.RowSelectionModel({selectActiveRow: false}));

                grid.onSort.subscribe(function (e, args) {
                    var cols = args.sortCols;
                    data.sort(function (dataRow1, dataRow2) {
                        for (var i = 0, l = cols.length; i < l; i++) {
                          var field = cols[i].sortCol.field;
                          var sign = cols[i].sortAsc ? 1 : -1;
                          var value1 = dataRow1[field], value2 = dataRow2[field];
                          var result = (value1 == value2 ? 0 : (value1 > value2 ? 1 : -1)) * sign;
                          if (result != 0) {
                            return result;
                          }
                        }
                        return 0;
                    });
                  grid.invalidate();
                  grid.render();
                });
                */
            }

            // 초기화 function
            var formReset = function(){
                for(var eleNum = 0; eleNum < 4; eleNum++){
                    $('#bootstrap-wizard-1').find('.form-wizard').children('li').eq(eleNum).removeClass('complete');
                    $('#bootstrap-wizard-1').find('.form-wizard').children('li').eq(eleNum).removeClass('active');
                    $('#bootstrap-wizard-1').find('.form-wizard').children('li').eq(eleNum).children('a').children('.step').html("");
                    $('#bootstrap-wizard-1').find('.form-wizard').children('li').eq(eleNum).children('a').children('.step').append(eleNum+1);
                }
                $('#bootstrap-wizard-1').find('.form-wizard').children('li').eq(0).addClass('active');
                $("div[id^='tab']").removeClass("active");
                $("#tab1").addClass("active");
                $('form').each(function(){
                    this.reset();
                });
                $("#csvGrid").empty();
                grid = null;
            }

            var stepCheck = function(index){
                $('#bootstrap-wizard-1').find('.form-wizard').children('li').eq(index - 1).addClass('complete');
                $('#bootstrap-wizard-1').find('.form-wizard').children('li').eq(index - 1).find('.step').html('<i class="fa fa-check"></i>');
                if(index === 4){
                    $(".btn btn-default txt-color-darken").text("Finish");
                }
            }
		</script>
	</body>
</html>